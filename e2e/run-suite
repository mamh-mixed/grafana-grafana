#!/bin/bash
set -xeo pipefail

. e2e/variables

HOST=${HOST:-$DEFAULT_HOST}
PORT=${PORT:-$DEFAULT_PORT}

echo -e "Starting Cypress scenarios"

args=("$@")

CMD="start"
PARAMS=""
SLOWMO=0
URL=${BASE_URL:-"http://$HOST:$PORT"}

if [ "$1" == "debug" ]; then
    echo -e "Debug mode"
    SLOWMO=1
    PARAMS="--no-exit"
fi

if [ "$1" == "dev" ]; then
    echo "Dev mode"
    CMD="open"
fi

cd packages/grafana-e2e

CYPRESS_CACHE_FOLDER=/tmp/Cypress/ yarn $CMD --env BASE_URL=$URL,SLOWMO=$SLOWMO \
  --config defaultCommandTimeout=30000,integrationFolder=../../e2e/"${args[0]}"/specs,screenshotsFolder=../../e2e"${args[0]}"/screenshots,videosFolder=../../e2e/"${args[0]}"/videos,fileServerFolder=./cypress,viewportWidth=1920,viewportHeight=1080,trashAssetsBeforeRuns=false,videoUploadOnPasses=false \
  $PARAMS
